{% extends "staff/base.html" %}

{% block title %}Maintenance Dashboard Â· AriStay{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total_assigned }}</div>
        <div class="stat-label">Total Assigned</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ overdue_tasks.count }}</div>
        <div class="stat-label">Overdue</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ today_tasks.count }}</div>
        <div class="stat-label">Due Today</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ low_stock_items.count }}</div>
        <div class="stat-label">Low Stock Items</div>
    </div>
</div>

{% if overdue_tasks %}
<div class="card">
    <div class="card-header">
        ğŸš¨ Overdue Tasks
    </div>
    {% for task in overdue_tasks %}
    <div class="task-item" style="border-left: 4px solid #f56565;">
        <div class="task-title">
            <a href="/api/staff/tasks/{{ task.id }}/" style="text-decoration: none; color: inherit;">
                {{ task.title }}
            </a>
        </div>
        <div class="task-meta">
            <span>ğŸ  {{ task.property.name }}</span>
            <span style="color: #c53030;">â° Due: {{ task.due_date|date:"M d, H:i" }}</span>
            <span class="status-badge status-{{ task.status|cut:'-' }}">{{ task.get_status_display }}</span>
            {% if task.assigned_to %}
            <span>ğŸ‘¤ {{ task.assigned_to.username }}</span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="grid">
    <div class="card">
        <div class="card-header">
            ğŸ”§ Today's Tasks
        </div>
        {% if today_tasks %}
            {% for task in today_tasks %}
            <div class="task-item">
                <div class="task-title">
                    <a href="/api/staff/tasks/{{ task.id }}/" style="text-decoration: none; color: inherit;">
                        {{ task.title }}
                    </a>
                </div>
                <div class="task-meta">
                    <span>ğŸ  {{ task.property.name }}</span>
                    {% if task.due_date %}
                    <span>â° {{ task.due_date|date:"H:i" }}</span>
                    {% endif %}
                    <span class="status-badge status-{{ task.status|cut:'-' }}">{{ task.get_status_display }}</span>
                    {% if task.assigned_to %}
                    <span>ğŸ‘¤ {{ task.assigned_to.username }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">âœ…</div>
                <p>No maintenance tasks due today!</p>
            </div>
        {% endif %}
    </div>

    <div class="card">
        <div class="card-header">
            ğŸ“¦ Low Stock Alerts
        </div>
        {% if low_stock_items %}
            {% for item in low_stock_items %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 0.5rem;">
                <div style="flex: 1;">
                    <div style="font-weight: 500;">{{ item.item.name }}</div>
                    <div style="font-size: 0.875rem; color: #666;">
                        ğŸ  {{ item.property_ref.name }} Â· ğŸ“¦ {{ item.item.category.name }}
                    </div>
                </div>
                <div style="text-align: right;">
                    <div class="status-badge status-{{ item.stock_status|cut:'_' }}">
                        {{ item.current_stock }} {{ item.item.get_unit_display }}
                    </div>
                    <div style="font-size: 0.75rem; color: #666;">
                        Par: {{ item.par_level }}
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/api/staff/inventory/" class="btn btn-primary btn-sm">
                    View All Inventory
                </a>
            </div>
        {% else %}
            <div class="empty-state">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“¦</div>
                <p>All inventory levels are healthy!</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="grid">
    <div class="card">
        <div class="card-header">
            ğŸ“‹ All Maintenance Tasks
        </div>
        {% if assigned_tasks %}
            {% for task in assigned_tasks|slice:":10" %}
            <div class="task-item">
                <div class="task-title">
                    <a href="/api/staff/tasks/{{ task.id }}/" style="text-decoration: none; color: inherit;">
                        {{ task.title }}
                    </a>
                </div>
                <div class="task-meta">
                    <span>ğŸ  {{ task.property.name }}</span>
                    {% if task.due_date %}
                    <span>ğŸ“… {{ task.due_date|date:"M d, H:i" }}</span>
                    {% endif %}
                    <span class="status-badge status-{{ task.status|cut:'-' }}">{{ task.get_status_display }}</span>
                </div>
            </div>
            {% endfor %}
            
            {% if assigned_tasks.count > 10 %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/api/staff/tasks/?type=maintenance" class="btn btn-secondary btn-sm">
                    View All {{ assigned_tasks.count }} Tasks
                </a>
            </div>
            {% endif %}
        {% else %}
            <div class="empty-state">
                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”§</div>
                <h3>No maintenance tasks assigned</h3>
                <p>Check back later or contact your manager.</p>
            </div>
        {% endif %}
    </div>

    <div class="card">
        <div class="card-header">
            ğŸ“Š Recent Inventory Activity
        </div>
        {% if recent_transactions %}
            {% for transaction in recent_transactions %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid #f1f5f9;">
                <div style="flex: 1;">
                    <div style="font-weight: 500;">{{ transaction.property_inventory.item.name }}</div>
                    <div style="font-size: 0.875rem; color: #666;">
                        ğŸ  {{ transaction.property_inventory.property_ref.name }}
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 500; color: {% if transaction.transaction_type == 'stock_in' %}#38a169{% elif transaction.transaction_type == 'stock_out' %}#e53e3e{% else %}#dd6b20{% endif %};">
                        {% if transaction.transaction_type == 'stock_in' %}+{% elif transaction.transaction_type == 'stock_out' %}-{% endif %}{{ transaction.quantity }} {{ transaction.property_inventory.item.get_unit_display }}
                    </div>
                    <div style="font-size: 0.75rem; color: #666;">
                        {{ transaction.created_at|date:"M d, H:i" }}
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/api/staff/inventory/" class="btn btn-secondary btn-sm">
                    View Inventory
                </a>
            </div>
        {% else %}
            <div class="empty-state">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“Š</div>
                <p>No recent inventory activity.</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-header">
        ğŸ› ï¸ Maintenance Tools & Actions
    </div>
    <div class="grid grid-2">
        <a href="/api/staff/tasks/" class="btn btn-primary">
            ğŸ“‹ View All Tasks
        </a>
        <a href="/api/staff/inventory/" class="btn btn-secondary">
            ğŸ“¦ Manage Inventory
        </a>
        <a href="/api/staff/tasks/?status=in_progress" class="btn btn-secondary">
            ğŸ”„ In Progress Tasks
        </a>
        <a href="/api/staff/lost-found/" class="btn btn-secondary">
            ğŸ” Lost & Found
        </a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .maintenance-tips {
        background: linear-gradient(135deg, #bee3f8 0%, #90cdf4 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 1rem;
    }
    
    .maintenance-tips h4 {
        margin-bottom: 1rem;
        color: #2a69ac;
    }
    
    .tip-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .tip-item {
        background: rgba(255, 255, 255, 0.7);
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
    }
</style>
{% endblock %}
