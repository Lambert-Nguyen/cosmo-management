{% extends "layouts/staff_layout.html" %}

{% block page_title %}Lost & Found{% endblock %}

{% block extra_css %}
{{ block.super }}
{% load static %}
<link rel="stylesheet" href="{% static 'css/pages/lost-found-list.css' %}">
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        ğŸ” Lost & Found Items
    </div>
    
    <!-- Status Filter -->
    <form method="get" class="lost-found-filter">
        <div class="lost-found-filter-row">
            <label for="status">Status:</label>
            <select name="status" id="status" class="lost-found-status-select">
                <option value="">All Statuses</option>
                {% for value, label in status_choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Filter</button>
            {% if status_filter %}
            <a href="/api/staff/lost-found/" class="btn btn-secondary">Clear</a>
            {% endif %}
        </div>
    </form>
    
    {% if items %}
        <div class="grid">
            {% for item in items %}
            <div class="card lost-found-item-card">
                <div class="lost-found-item-header">
                    <div class="lost-found-item-content">
                        <div class="lost-found-item-title">{{ item.title }}</div>
                        <div class="lost-found-item-meta">
                            ğŸ  {{ item.property_ref.name }}
                            {% if item.found_location %}Â· ğŸ“ {{ item.found_location }}{% endif %}
                        </div>
                        {% if item.description %}
                        <div class="lost-found-item-description">
                            {{ item.description }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="lost-found-item-status">
                        <div class="status-badge status-{{ item.status|cut:'-' }} lost-found-status-badge">
                            {{ item.get_status_display }}
                        </div>
                        <div class="lost-found-found-date">
                            Found: {{ item.found_date|date:"M d, Y" }}
                        </div>
                    </div>
                </div>
                
                <div class="lost-found-item-details">
                    {% if item.estimated_value %}
                    <div class="lost-found-detail">
                        <strong>Est. Value:</strong> ${{ item.estimated_value }}
                    </div>
                    {% endif %}
                    
                    {% if item.found_by %}
                    <div class="lost-found-detail">
                        <strong>Found by:</strong> {% if item.found_by %}{{ item.found_by.get_full_name|default:item.found_by.username }}{% else %}Unknown{% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Photos -->
                {% if item.photos.all %}
                <div class="lost-found-photos">
                    <div class="lost-found-photos-title">Photos:</div>
                    <div class="lost-found-photos-grid">
                        {% for photo in item.photos.all %}
                        <img src="{{ photo.image.url }}" 
                             alt="Lost item photo"
                             class="lost-found-photo-thumb"
                             data-photo-url="{{ photo.image.url }}">
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Action buttons -->
                <div class="lost-found-actions">
                    {% if user.is_staff %}
                    <a href="/admin/api/lostfounditem/{{ item.id }}/change/" class="btn btn-secondary btn-sm">
                        âœï¸ Edit
                    </a>
                    {% endif %}
                    
                    {% if item.status == 'found' %}
                    <button type="button" class="btn btn-success btn-sm js-mark-claimed" data-item-id="{{ item.id }}">
                        âœ… Mark Claimed
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="lost-found-empty-icon">ğŸ”</div>
            <h3>No lost & found items</h3>
            {% if status_filter %}
            <p>No items found with the selected status.</p>
            <a href="/api/staff/lost-found/" class="btn btn-primary">View All Items</a>
            {% else %}
            <p>No items have been reported yet.</p>
            {% endif %}
        </div>
    {% endif %}
</div>

<div class="card">
    <div class="card-header">
        ğŸ“ Report Found Item
    </div>
    <p>Found something? Report it through the admin interface or notify your manager.</p>
    <div class="lost-found-report-actions">
        {% if user.is_staff %}
        <a href="/admin/api/lostfounditem/add/" class="btn btn-primary">
            â• Add Found Item
        </a>
        {% endif %}
        <a href="/api/staff/" class="btn btn-secondary">
            ğŸ  Back to Dashboard
        </a>
    </div>
</div>

<!-- Photo Modal -->
<div id="photoModal" class="lost-found-photo-modal" aria-hidden="true">
    <div class="lost-found-photo-modal-inner">
        <img id="modalPhoto" class="lost-found-photo-modal-img" alt="Lost item photo">
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% load static %}
<script type="module" src="{% static 'js/pages/lost-found-list.js' %}"></script>
{% endblock %}

