{% extends "portal/base.html" %}
{% load static %}

{% block title %}Email Digest Settings{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/portal-digest-settings.css' %}">
{% endblock %}

{% block head %}
<script type="module" src="{% static 'js/pages/portal-digest-settings.js' %}"></script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="portal-digest-shell">
        <!-- Header -->
        <div class="portal-digest-header">
            <h1 class="portal-digest-title">ğŸ“§ Email Digest Settings</h1>
            <p class="portal-digest-subtitle">Manage your daily task digest preferences</p>
        </div>

        <!-- Status Card -->
        <div class="card portal-digest-status-card">
            <div class="portal-digest-status-inner">
                {% if global_enabled %}
                    <div class="portal-digest-status-badge portal-digest-status-badge--enabled">
                        âœ… Email Digest Available
                    </div>
                    <p class="portal-digest-muted">Daily task digests are enabled system-wide</p>
                {% else %}
                    <div class="portal-digest-status-badge portal-digest-status-badge--disabled">
                        âŒ Email Digest Disabled
                    </div>
                    <p class="portal-digest-muted">Email digests are currently disabled system-wide</p>
                {% endif %}
            </div>
        </div>

        <!-- Settings Form -->
        <div class="card">
            <div class="portal-digest-card-inner">
                <h3 class="portal-digest-section-title">Your Preferences</h3>
                
                <form id="digestSettingsForm">
                    {% csrf_token %}
                    
                    <!-- Opt-out Setting -->
                    <div class="portal-digest-optout-wrap">
                        <div class="portal-digest-optout-card">
                            <input type="checkbox" id="digest_opt_out" name="digest_opt_out" 
                                   {% if profile.digest_opt_out %}checked{% endif %}
                                   class="portal-digest-optout-checkbox">
                            <div class="portal-digest-optout-body">
                                <label for="digest_opt_out" class="portal-digest-optout-label">
                                    Opt out of email digest
                                </label>
                                <p class="portal-digest-optout-desc">
                                    Check this box to stop receiving daily task digest emails. You can re-enable them at any time.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Info Box -->
                    <div class="portal-digest-info">
                        <div class="portal-digest-info-row">
                            <span class="portal-digest-info-icon">ğŸ’¡</span>
                            <div class="portal-digest-info-body">
                                <h4 class="portal-digest-info-title">About Email Digests</h4>
                                <p class="portal-digest-info-text">
                                    The daily digest email contains a summary of your tasks, including newly assigned tasks, upcoming deadlines, and overdue items. 
                                    Digests are sent once per day based on your timezone settings.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="portal-digest-save-row">
                        <button type="submit" class="button portal-digest-save-btn"
                                {% if not global_enabled %}disabled{% endif %}>
                            Save Settings
                        </button>
                    </div>
                </form>

                <!-- Current Status -->
                <div class="portal-digest-current">
                    <h4 class="portal-digest-current-title">Current Status:</h4>
                    <div class="portal-digest-current-row">
                        {% if profile.digest_opt_out %}
                            <span class="portal-digest-current-icon--off">âŒ</span>
                            <span class="portal-digest-current-text--off">You are opted out of digest emails</span>
                        {% else %}
                            <span class="portal-digest-current-icon--on">âœ…</span>
                            <span class="portal-digest-current-text--on">You will receive digest emails {% if not global_enabled %}(when enabled){% endif %}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="portal-digest-nav">
            <a href="/api/portal/" class="button portal-digest-back-btn">
                â† Back to Portal
            </a>
        </div>
    </div>
</div>

<!-- Success/Error Messages -->
<div id="messageContainer" class="portal-digest-message-container hidden">
    <div id="messageContent" class="portal-digest-message-content"></div>
</div>
{% endblock %}