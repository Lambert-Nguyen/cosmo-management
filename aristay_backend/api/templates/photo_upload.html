{% extends "layouts/staff_layout.html" %}
{% load static %}

{% block page_title %}Photo Upload{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/photo-upload.css' %}">
{% endblock %}

{% block content %}
<div class="photo-upload-container">
    <div class="page-header">
        <h1>ğŸ“¸ Photo Upload</h1>
        <p>Upload before and after photos for tasks</p>
    </div>

    <!-- Task Information -->
    {% if selected_task %}
    <div class="upload-section">
        <div class="task-info-header">
            <div>
                <h3 class="task-title-text">ğŸ“‹ Task: {{ selected_task.title }}</h3>
                <p class="task-meta">
                    Property: {{ selected_task.property_ref.name }} |
                    Status: <span class="task-status">{{ selected_task.get_status_display }}</span>
                </p>
            </div>
            <a href="/api/staff/tasks/{{ selected_task.id }}/" class="back-link">
                â† Back to Task Detail
            </a>
        </div>
    </div>
    {% else %}
    <div class="upload-section">
        <div class="warning-box">
            <h3 class="warning-title">âš ï¸ No Task Selected</h3>
            <p class="warning-message">Please access this page from a task detail view to upload photos.</p>
            <a href="/api/staff/" class="warning-link">
                Go to Staff Dashboard
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Upload Area -->
    <div class="upload-section" id="upload-area">
        <div class="upload-area" id="upload-zone">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-text">Drag & drop photos here</div>
            <div class="upload-subtext">or click to browse files</div>
            <input type="file" id="file-input" class="file-input" multiple accept="image/*">
        </div>
        <div class="progress-bar" id="progress-bar" data-visibility="hidden">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div id="status-message"></div>
    </div>

    <!-- Photo Previews -->
    <div class="photo-preview-grid" id="photo-preview-grid">
        <!-- Photos will be added here dynamically -->
    </div>

    <!-- Upload Actions -->
    <div class="upload-actions" id="upload-actions" data-visibility="hidden">
        <button class="btn btn-primary" id="upload-btn">
            <span>ğŸ“¤</span>
            Upload Photos
        </button>
        <button class="btn btn-secondary" id="clear-btn">
            <span>ğŸ—‘ï¸</span>
            Clear All
        </button>
    </div>

    <!-- Uploaded Photos Section -->
    <div id="uploaded-photos-container">
        <!-- Recently uploaded photos will be displayed here -->
    </div>
</div>

<script>
// Set user permissions for photo approval
window.userCanApprovePhotos = {{ can_approve_photos|yesno:"true,false" }};
</script>
<script src="{% static 'js/pages/photo-upload.js' %}"></script>
{% endblock %}

