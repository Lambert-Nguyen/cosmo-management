{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'css/pages/admin-excel-import.css' %}">
{% endblock %}

{% block content %}
<div class="excel-import-container">
    <div class="import-header">
        <h1>ğŸ“Š Excel Booking Import</h1>
        <p>Import daily booking schedules from Excel files to automatically create and update tasks</p>
    </div>

    <!-- Mobile-Optimized Instructions -->
    <div class="instructions">
        <h3>ğŸ“‹ Import Instructions</h3>
        <ul>
            <li><strong>File Format:</strong> Excel (.xlsx) files only</li>
            <li><strong>Required Sheet:</strong> "Cleaning schedule" (case sensitive)</li>
            <li><strong>Columns:</strong> Confirmation code, Status, Guest name, Contact, Booking Source, Listing, Earnings, Booked, Adults/Children/Infants, Start/End dates, Nights, Properties</li>
            <li><strong>Auto-Tasks:</strong> Cleaning tasks will be automatically created for each booking</li>
        </ul>
    </div>

    <!-- Mobile-Optimized Upload Section -->
    <div class="upload-section" id="uploadSection">
        <h3 style="margin-bottom: var(--space-3); color: var(--color-text);">ğŸ“ Upload Excel File</h3>
        <p style="margin-bottom: var(--space-3); color: var(--color-text-secondary);">Drag and drop your Excel file here or click to browse</p>

        <div class="file-input-wrapper">
            <input type="file" id="excelFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
            <label for="excelFile" class="upload-button">ğŸ“ Choose Excel File</label>
        </div>

        <div class="file-info" id="fileInfo"></div>
    </div>

    <!-- Mobile-Optimized Import Form -->
    <form class="import-form" id="importForm" style="display: none;">
        <div class="grid cols-1">
            <div>
                <label for="sheetName" style="display: block; margin-bottom: var(--space-1); font-weight: var(--font-weight-semibold);">Sheet Name:</label>
                <input type="text" id="sheetName" name="sheet_name" value="Cleaning schedule" readonly>
            </div>

            <div>
                <label for="autoCreateTasks" style="display: block; margin-bottom: var(--space-1); font-weight: var(--font-weight-semibold);">Auto-Create Tasks:</label>
                <select id="autoCreateTasks" name="auto_create_tasks">
                    <option value="true">âœ… Yes - Create cleaning tasks automatically</option>
                    <option value="false">âŒ No - Import bookings only</option>
                </select>
            </div>
        </div>

        <button type="submit" class="submit-button" id="submitBtn">
            ğŸš€ Start Import
        </button>
    </form>

    <!-- Mobile-Optimized Progress Bar -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Mobile-Optimized Import Log Display -->
    {% if import_log %}
    <div class="recent-imports">
        <h3 style="margin-bottom: var(--space-3); color: var(--color-text);">ğŸ“Š Last Import Results</h3>

        <div class="import-log-item {% if import_log.errors_count == 0 %}success{% else %}error{% endif %}">
            <div style="font-weight: var(--font-weight-semibold); margin-bottom: var(--space-2);">
                Import completed at {{ import_log.imported_at|date:"M d, Y H:i" }}
            </div>

            <div class="import-stats">
                <span>ğŸ“¥ Total: {{ import_log.total_rows }}</span>
                <span>âœ… Success: {{ import_log.successful_imports }}</span>
                <span>âŒ Errors: {{ import_log.errors_count }}</span>
                {% if import_log.errors_count > 0 %}
                <span>âš ï¸ Warnings: {{ import_log.errors_count }}</span>
                {% endif %}
            </div>

            {% if import_log.errors_log %}
            <div style="margin-top: var(--space-3);">
                <button class="btn btn-secondary btn-sm" onclick="toggleImportLog()">
                    ğŸ“‹ View Details
                </button>
                <div class="import-log" id="importLog" style="display: none; margin-top: var(--space-2);">
                    {{ import_log.errors_log|linebreaks }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Mobile-Optimized Success/Error Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
</div>

<script src="{% static 'js/pages/admin-excel-import.js' %}" defer></script>
{% endblock %}
