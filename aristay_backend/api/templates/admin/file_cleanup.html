{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}File Cleanup Management - {{ block.super }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/pages/admin-file-cleanup.css' %}">
{% endblock %}

{% block extrahead %}
{{ block.super }}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="module" src="{% static 'js/pages/admin-file-cleanup.js' %}"></script>
{% endblock %}

{% block content %}
<div class="cleanup-container">
    <div class="cleanup-header">
        <h1>üìÅ File Cleanup Management</h1>
        <p>Manage Excel import file storage to optimize disk usage and maintain system performance</p>
    </div>

    <div class="action-cards">
        <!-- Storage Stats Card -->
        <div class="action-card">
            <div class="card-header">
                <div class="card-icon stats">üìä</div>
                <h3 class="card-title">Storage Statistics</h3>
            </div>
            <p class="card-description">
                View current storage usage, file counts, and storage analytics for import files.
            </p>
            <div class="card-form">
                <button type="button" class="btn btn-primary" data-action="file-cleanup-stats">
                    Get Storage Stats
                </button>
            </div>
        </div>

        <!-- Cleanup Suggestions Card -->
        <div class="action-card">
            <div class="card-header">
                <div class="card-icon suggest">üí°</div>
                <h3 class="card-title">Smart Suggestions</h3>
            </div>
            <p class="card-description">
                Get intelligent recommendations on how many days of files to keep to meet your storage targets.
            </p>
            <div class="card-form">
                <div class="form-group">
                    <label for="target-size">Target Size (MB):</label>
                    <input type="number" id="target-size" class="form-control" value="100" min="1" max="10000">
                </div>
                <button type="button" class="btn btn-warning" data-action="file-cleanup-suggestions">
                    Get Suggestions
                </button>
            </div>
        </div>

        <!-- Dry Run Card -->
        <div class="action-card">
            <div class="card-header">
                <div class="card-icon dry-run">üîç</div>
                <h3 class="card-title">Preview Cleanup</h3>
            </div>
            <p class="card-description">
                Preview what files would be deleted without actually removing them. Safe to run anytime.
            </p>
            <div class="card-form">
                <div class="form-group">
                    <label for="dry-run-days">Keep Files (Days):</label>
                    <input type="number" id="dry-run-days" class="form-control" value="30" min="1" max="365">
                </div>
                <button type="button" class="btn btn-info" data-action="file-cleanup-dry-run">
                    Preview Cleanup
                </button>
            </div>
        </div>

        <!-- Actual Cleanup Card -->
        <div class="action-card">
            <div class="card-header">
                <div class="card-icon cleanup">üóëÔ∏è</div>
                <h3 class="card-title">Perform Cleanup</h3>
            </div>
            <p class="card-description">
                <strong>‚ö†Ô∏è Permanent action:</strong> Delete old import files to free up disk space. This cannot be undone.
            </p>
            <div class="card-form">
                <div class="form-group">
                    <label for="cleanup-days">Keep Files (Days):</label>
                    <input type="number" id="cleanup-days" class="form-control" value="30" min="1" max="365">
                </div>
                <button type="button" class="btn btn-danger" data-action="file-cleanup-confirm">
                    Perform Cleanup
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        Processing request...
    </div>

    <!-- Results Container -->
    <div id="results-container" class="results-container">
        <div class="results-header">
            <h3 id="results-title" class="results-title">Results</h3>
            <button type="button" class="close-results" data-action="file-cleanup-hide-results">√ó</button>
        </div>
        <div id="results-content">
            <!-- Results will be populated here -->
        </div>
    </div>
</div>

<!-- Confirmation Dialog -->
<div id="confirmation-dialog" class="confirmation-dialog">
    <div class="dialog-content">
        <h3 class="dialog-title">Confirm File Cleanup</h3>
        <div id="dialog-message" class="dialog-message">
            Are you sure you want to perform this cleanup operation? This action cannot be undone.
        </div>
        <div class="dialog-actions">
            <button type="button" class="btn btn-primary" data-action="file-cleanup-hide-confirmation">Cancel</button>
            <button type="button" class="btn btn-danger" data-action="file-cleanup-perform">Delete Files</button>
        </div>
    </div>
</div>

{% csrf_token %}
<script src="{% static 'admin/js/file_cleanup.js' %}"></script>
{% endblock %}