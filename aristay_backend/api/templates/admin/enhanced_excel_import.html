{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Enhanced Excel Import - {{ block.super }}{% endblock %}

{% block extrahead %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{% static 'css/pages/admin-enhanced-excel-import.css' %}">
<script type="module" src="{% static 'js/pages/admin-enhanced-excel-import.js' %}"></script>
{% endblock %}

{% block content %}
<div class="import-container">
    <h1>üìä Enhanced Excel Import with Conflict Resolution</h1>
    
    <div class="feature-highlight">
        <h4>üöÄ New Features</h4>
        <ul class="feature-list">
            <li><strong>Smart Conflict Detection:</strong> Automatically detects conflicts between existing bookings and Excel data</li>
            <li><strong>Platform vs Direct Booking Intelligence:</strong> Platform bookings (Airbnb, VRBO) auto-update, direct bookings require review</li>
            <li><strong>Interactive Conflict Resolution:</strong> Visual interface to review and resolve conflicts manually</li>
            <li><strong>Confidence Scoring:</strong> AI-powered confidence scores help identify likely matches</li>
            <li><strong>Bulk Actions:</strong> Resolve multiple conflicts at once with bulk operations</li>
            <li><strong>Complete Audit Trail:</strong> Full history of all changes and decisions made</li>
        </ul>
    </div>
    
    <form method="post" enctype="multipart/form-data" id="importForm">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="excel_file">Select Excel File:</label>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <p>Drag & drop your Excel file here or click to browse</p>
                <input type="file" name="excel_file" id="excel_file" class="form-control aeei-file-input" accept=".xlsx,.xls" required>
                <button type="button" class="btn btn-secondary" data-action="aeei-choose-file">
                    Choose File
                </button>
            </div>
            <div id="fileName" class="aeei-file-name is-hidden"></div>
        </div>
        
        <div class="form-group">
            <label for="sheet_name">Sheet Name:</label>
            <input type="text" name="sheet_name" id="sheet_name" value="Cleaning schedule" class="form-control" 
                   placeholder="Enter the name of the Excel sheet to import">
            <small class="aeei-sheet-hint">Default: "Cleaning schedule"</small>
        </div>
        
        {% if templates %}
        <div class="form-group">
            <label for="template">Import Template (Optional):</label>
            <select name="template" id="template" class="form-control">
                <option value="">-- No Template --</option>
                {% for template in templates %}
                    <option value="{{ template.pk }}">{{ template.name }} - {{ template.description }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <div class="form-group">
            <button type="submit" class="btn btn-primary" id="submitBtn">
                üöÄ Start Enhanced Import
            </button>
            <a href="{% url 'admin:api_bookingimportlog_changelist' %}" class="btn btn-secondary">
                üìã View Import History
            </a>
        </div>
    </form>
    
    <div class="progress-container is-hidden" id="progressContainer">
        <h4>Import Progress</h4>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <p id="progressText">Processing...</p>
    </div>
    
    <div class="result-container is-hidden" id="resultContainer">
        <div id="resultContent"></div>
    </div>
</div>

{% endblock %}
