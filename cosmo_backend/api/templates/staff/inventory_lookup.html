{% extends "layouts/staff_layout.html" %}

{% block page_title %}Inventory Lookup{% endblock %}

{% block extra_css %}
{{ block.super }}
{% load static %}
<link rel="stylesheet" href="{% static 'css/pages/inventory-lookup.css' %}">
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        ğŸ“¦ Inventory Lookup
    </div>
    
    <!-- Enhanced Mobile-Friendly Property Filter -->
    <form method="get" class="filter-form">
        <div class="filter-grid">
            <div class="filter-group">
                <label for="property" class="filter-label">Property:</label>
                <select name="property" id="property" class="filter-select">
                    <option value="">All Properties</option>
                    {% for prop in properties %}
                    <option value="{{ prop.id }}" {% if prop.id|stringformat:"s" == selected_property %}selected{% endif %}>
                        {{ prop.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn btn-primary filter-btn">ğŸ” Filter</button>
                {% if selected_property %}
                <a href="/api/staff/inventory/" class="btn btn-secondary filter-btn">ğŸ—‘ï¸ Clear</a>
                {% endif %}
            </div>
        </div>
    </form>
    
    {% if inventory_by_category %}
        {% for category, items in inventory_by_category.items %}
        <div class="inventory-category-section">
            <h3 class="inventory-category-title">
                ğŸ“¦ {{ category }}
            </h3>
            
            <div class="grid grid-2">
                {% for item in items %}
                <div class="inventory-item" data-inventory-id="{{ item.id }}" data-unit="{{ item.item.get_unit_display }}">
                    <div class="inventory-item-header">
                        <div class="inventory-item-main">
                            <div class="inventory-item-name">{{ item.item.name }}</div>
                            <div class="inventory-item-meta">
                                ğŸ  {{ item.property_ref.name }}
                            </div>
                            {% if item.item.description %}
                            <div class="inventory-item-description">
                                {{ item.item.description }}
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="inventory-item-stock">
                            <div class="status-badge status-{{ item.stock_status|cut:'_' }} inventory-stock-badge">
                                {{ item.current_stock }} {{ item.item.get_unit_display }}
                            </div>
                            <div class="inventory-item-par">
                                Par: {{ item.par_level }} Â· Max: {{ item.max_level|default:"N/A" }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Transaction Form -->
                    {% if user.profile and user.profile.role == 'maintenance' or user.is_staff %}
                    <div class="inventory-transaction-panel">
                        <div class="inventory-transaction-row">
                            <select class="transaction-type transaction-input">
                                <option value="stock_out">Use (-)</option>
                                <option value="stock_in">Restock (+)</option>
                                <option value="adjustment">Adjust</option>
                                <option value="damage">Damage (-)</option>
                            </select>
                            
                            <input type="number" 
                                   class="transaction-quantity transaction-input" 
                                   min="0" 
                                   step="0.1" 
                                   placeholder="Qty"
                                   inputmode="decimal">
                            
                            <button type="button" 
                                    class="btn btn-primary btn-sm log-transaction"
                                    data-action="log-transaction">
                                Log
                            </button>
                        </div>
                        
                        <input type="text" 
                               class="transaction-notes transaction-input" 
                               placeholder="Notes (optional)"
                               autocomplete="off">
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="inventory-empty-icon">ğŸ“¦</div>
            <h3>No inventory found</h3>
            {% if selected_property %}
            <p>No inventory items found for the selected property.</p>
            <a href="/api/staff/inventory/" class="btn btn-primary">View All Properties</a>
            {% else %}
            <p>No inventory items have been set up yet.</p>
            {% endif %}
        </div>
    {% endif %}
</div>

{% if user.profile and user.profile.role == 'maintenance' or user.is_staff %}
<div class="card">
    <div class="card-header">
        ğŸ”§ Maintenance Tools
    </div>
    <div class="grid grid-3">
        <a href="/api/staff/tasks/" class="btn btn-secondary">
            ğŸ“‹ My Tasks
        </a>
        <a href="/api/staff/" class="btn btn-secondary">
            ğŸ  Dashboard
        </a>
        {% if user.is_staff %}
        <a href="/admin/api/propertyinventory/" class="btn btn-secondary">
            âš™ï¸ Manage Inventory
        </a>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% load static %}
<script type="module" src="{% static 'js/pages/inventory-lookup.js' %}"></script>
{% endblock %}
