{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}{% trans 'Site administration' %} | {{ site_title|default:_('Cosmo Manager') }}{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'manager_admin:index' %}">{{ site_header|default:_('Cosmo Manager') }}</a>
</h1>
{% endblock %}

{% block nav-sidebar %}{% endblock %}

{% block header %}
<div id="header" class="ma-header">
    <div class="ma-header-inner">
        <div class="ma-brand">
            <img src="{% static 'images/cosmo_logo.jpg' %}" alt="Cosmo" class="ma-brand-logo">
            <div>
                <h1 class="ma-header-site-name">
                    <a href="{% url 'manager_admin:index' %}">
                        {{ site_header|default:_('Cosmo Manager') }}
                    </a>
                </h1>
                <p class="ma-header-subtitle">Property Management Console</p>
            </div>
        </div>

        <div class="ma-header-actions">
            <a href="/api/portal/" class="ma-header-link">
                <span class="ma-header-link-icon">ğŸ </span>
                <span class="ma-header-link-label">Portal</span>
            </a>

            {% if user.is_superuser %}
            <a href="/admin/" class="ma-header-link">
                <span class="ma-header-link-icon">âš™ï¸</span>
                <span class="ma-header-link-label">Admin</span>
            </a>
            {% endif %}

            <button id="menu-toggle" class="ma-menu-toggle" aria-label="Toggle menu" title="Open quick menu" type="button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extrastyle %}
<!-- Cosmo Favicons -->
<link rel="icon" type="image/x-icon" href="{% static 'images/favicons/favicon.ico' %}">
<link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicons/favicon-32x32.png' %}">
<link rel="apple-touch-icon" href="{% static 'images/favicons/apple-touch-icon.png' %}">
<meta name="theme-color" content="#8b5cf6">

<!-- Theme Toggle Styles -->
<link rel="stylesheet" href="{% static 'css/theme-toggle.css' %}">
<link rel="stylesheet" href="{% static 'css/pages/manager-admin-index.css' %}">
{% endblock %}

{% block content %}
<!-- Side Menu Panel -->
<div id="side-menu" class="ma-side-menu">
    <div class="ma-side-menu-inner">
        <!-- Menu Header -->
        <div class="ma-menu-header">
            <div class="ma-menu-user">
                <img src="{% static 'images/cosmo_logo.jpg' %}"
                     alt="Cosmo"
                     class="ma-menu-logo">
                <div>
                    <h3 class="ma-menu-title">Quick Menu</h3>
                    <p class="ma-menu-subtitle">{{ user.get_full_name|default:user.username }}</p>
                </div>
            </div>
            <button id="close-menu" class="ma-menu-close" aria-label="Close menu" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        
        <!-- Quick Links -->
        <div class="ma-menu-links">
            <!-- View Site -->
            <a href="/" class="ma-menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                <span class="ma-menu-link-label">View Site</span>
            </a>
            
            <!-- Change Password -->
            <a href="/admin/password_change/" class="ma-menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <circle cx="12" cy="16" r="1"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <span class="ma-menu-link-label">Change Password</span>
            </a>
            
            <!-- Dark Mode Toggle -->
            <div class="ma-menu-row">
                <div class="ma-menu-row-left">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <span class="ma-menu-row-label">Dark Mode</span>
                </div>
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" title="Toggle light/dark mode" type="button">
                    <svg class="theme-toggle-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="theme-toggle-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
            
            <!-- Log Out -->
            <a href="/logout/" class="ma-menu-logout">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16,17 21,12 16,7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span class="ma-menu-link-label">Log Out</span>
            </a>
        </div>
    </div>
</div>

<!-- Overlay -->
<div id="menu-overlay" class="ma-menu-overlay"></div>

<!-- Hidden Sarcastic Message - Manager Edition -->
<div id="cosmo-secret-message-manager" class="ma-secret-message is-hidden">
    <div class="ma-secret-title">
        ğŸ‘” A Manager's Secret Confession ğŸ‘”
    </div>
    <div class="ma-secret-body">Oh, have you no shame, dear friend of mine?
To strut about boldly, crossing the line?
With cheek so divine and nerve so grand,
You march unashamed through all the land.

What audacity fills your trembling soul,
To flaunt your misdeeds as your lofty goal?
No blush, no hint of modesty's flame,
Tell me truly, have you no shame?

You wear shameless acts like a badge of pride,
As if decency has left your side.
Oh, the gall, the nerve, the unabashed gameâ€”
Pray tell, dear friend, have you no shame?</div>
    <button type="button" data-action="manager-secret-close" class="ma-secret-close">ğŸ­ Close This Managerial Secret ğŸ­</button>
</div>

<!-- Secret Message Overlay -->
<div id="secret-message-overlay-manager" class="ma-secret-overlay is-hidden"></div>

<div id="content-main">
    <div class="welcome-section">
        <div class="logo-container">
            <img src="{% static 'images/cosmo_logo.jpg' %}" alt="Cosmo Logo" class="welcome-logo">
            <div class="welcome-text">
                <h1 class="welcome-title">Welcome to Cosmo Manager Console</h1>
                <p class="welcome-subtitle">Your comprehensive property and task management dashboard</p>
            </div>
        </div>
        <div class="manager-badge">ğŸ‘¨â€ğŸ’¼ Manager Access</div>
    </div>

    <div class="dashboard-section">
        <div class="dashboard-title">ğŸ“Š Quick Actions</div>
        <div class="quick-actions">
            <a href="{% url 'manager_admin:manager_charts' %}" class="action-card">
                <span class="action-icon">ğŸ“ˆ</span>
                <span class="action-label">Analytics Dashboard</span>
                <span class="action-description">View detailed analytics, performance metrics, and business insights</span>
            </a>
            <a href="{% url 'task-list' %}" class="action-card">
                <span class="action-icon">ğŸ“‹</span>
                <span class="action-label">Manage Tasks</span>
                <span class="action-description">Oversee all cleaning and maintenance tasks across properties</span>
            </a>
            <a href="{% url 'manager_admin:api_property_changelist' %}" class="action-card">
                <span class="action-icon">ğŸ¢</span>
                <span class="action-label">Manage Properties</span>
                <span class="action-description">Control property details, settings, and configurations</span>
            </a>
            <a href="{% url 'manager_admin:auth_user_changelist' %}" class="action-card">
                <span class="action-icon">ğŸ‘¥</span>
                <span class="action-label">Manage Users</span>
                <span class="action-description">Handle team members, roles, and access permissions</span>
            </a>
            <a href="/manager/invite-codes/" class="action-card">
                <span class="action-icon">ğŸ«</span>
                <span class="action-label">Invite Codes</span>
                <span class="action-description">Create and manage invite codes for user registration</span>
            </a>
            <a href="/api/manager/enhanced-excel-import/" class="action-card">
                <span class="action-icon">ğŸ“Š</span>
                <span class="action-label">Enhanced Excel Import</span>
                <span class="action-description">Advanced booking import with conflict detection and duplicate prevention</span>
            </a>
            <a href="/api/excel-import/" class="action-card">
                <span class="action-icon">ğŸ“…</span>
                <span class="action-label">Basic Excel Import</span>
                <span class="action-description">Simple Excel file upload for booking schedules (legacy)</span>
            </a>
            <a href="/api/admin/digest-management/" class="action-card">
                <span class="action-icon">ğŸ“§</span>
                <span class="action-label">Email Digest</span>
                <span class="action-description">Configure and send daily task digest emails to users</span>
            </a>
            <a href="/api/admin/notification-management/" class="action-card">
                <span class="action-icon">ğŸ””</span>
                <span class="action-label">Notifications</span>
                <span class="action-description">Manage and test the notification system</span>
            </a>
        </div>
        
        <!-- File Management Section -->
        <div class="dashboard-section">
            <div class="dashboard-title">ğŸ—‚ï¸ File Management</div>
            <div class="actions-grid">
                <div class="action-card-mini" id="file-cleanup-card">
                    <span class="action-icon">ğŸ—‘ï¸</span>
                    <span class="action-label">File Cleanup</span>
                    <span class="action-description">Manage import file storage and cleanup old files</span>
                    <div class="file-cleanup-controls ma-file-cleanup-controls">
                        <button type="button" data-action="manager-file-cleanup-stats" class="btn-small">ğŸ“Š Show Stats</button>
                        <button type="button" data-action="manager-file-cleanup-options" class="btn-small">ğŸ§¹ Cleanup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Cleanup Modal -->
    <div id="fileCleanupModal" class="modal is-hidden">
        <div class="modal-content">
            <span class="close" role="button" tabindex="0" data-action="manager-file-cleanup-close">&times;</span>
            <h2>File Storage Management</h2>
            <div id="fileCleanupContent">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    {% if app_list %}
    <div class="dashboard-section">
        <div class="dashboard-title">ğŸ› ï¸ Administration</div>
        
        {% for app in app_list %}
            <div class="app-{{ app.app_label }} module">
                <table>
                    <caption>
                        <a href="{{ app.app_url }}" class="section" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{ app.name }}</a>
                    </caption>
                    {% for model in app.models %}
                        <tr class="model-{{ model.object_name|lower }}">
                            {% if model.admin_url %}
                                <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                            {% else %}
                                <th scope="row">{{ model.name }}</th>
                            {% endif %}

                            {% if model.add_url %}
                                <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                            {% else %}
                                <td>&nbsp;</td>
                            {% endif %}

                            {% if model.admin_url %}
                                {% if model.view_only %}
                                    <td><a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a></td>
                                {% else %}
                                    <td><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
                                {% endif %}
                            {% else %}
                                <td>&nbsp;</td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        {% endfor %}
    </div>
    {% else %}
        <div class="dashboard-section">
            <p>{% trans "You don't have permission to view or edit anything." %}</p>
        </div>
    {% endif %}

    <div class="admin-info">
        <div class="dashboard-title">â„¹ï¸ Manager Information</div>
        <p><strong>Manager:</strong> {{ user.get_full_name|default:user.username }}</p>
        <p><strong>Access Level:</strong> 
            {% if user.is_superuser %}
                ğŸ”´ Superuser (Full Access)
            {% else %}
                ğŸŸ¢ Manager (Property Management Access)
            {% endif %}
        </p>
        <p><strong>Last Login:</strong> {{ user.last_login|date:"M d, Y H:i" }}</p>
        <p><strong>Current Time:</strong> <span id="current-time">{{ "now"|date:"M d, Y H:i" }}</span></p>
        <p><strong>Console Version:</strong> Cosmo Manager v2.0</p>
    </div>

    <!-- Footer with Copyright -->
    <footer class="ma-footer">
        <p>&copy; 2025 Nguyen Phuong Duy Lam. All rights reserved. | <a href="https://lambertnguyen.cloud/company/products" target="_blank">Visit Our Products</a></p>
        <p>Built with â¤ï¸ for learning.</p>
    </footer>
</div>
<!-- Theme Toggle Script -->
<script src="{% static 'js/theme-toggle.js' %}"></script>

<div id="managerAdminConfig" class="is-hidden" data-auth-token="{{ request.user.auth_token.key|default:'' }}"></div>
<script type="module" src="{% static 'js/pages/manager-admin-index.js' %}"></script>
{% endblock %}