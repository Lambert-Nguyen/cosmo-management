{% load static %}
{% load timezone_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Cosmo Portal{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicons/favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicons/favicon-32x32.png' %}">
    <link rel="apple-touch-icon" href="{% static 'images/favicons/apple-touch-icon.png' %}">
    <meta name="theme-color" content="#6366f1">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <link rel="stylesheet" href="{% static 'css/theme-toggle.css' %}">
    <link rel="stylesheet" href="{% static 'css/pages/portal-base.css' %}">
    {% block head %}{% endblock %}
    {% block extra_css %}{% endblock %}
</head>
<body>
    <header class="portal-header">
        <div class="container">
            <div class="brand">
                <div class="brand-left">
                    <img class="portal-brand-logo" src="{% static 'images/cosmo_logo.jpg' %}" alt="Cosmo">
                    <h1>Cosmo Portal</h1>
                </div>
                
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" type="button" data-action="portal-toggle-nav" aria-controls="navMenu" aria-expanded="false">
                    â˜°
                </button>

                <!-- Navigation Menu -->
                <div class="nav-menu" id="navMenu">
                    {% if user.is_authenticated %}
                        <!-- Always show Home link -->
                        <a href="/api/portal/" class="button">ğŸ  Home</a>
                        
                        <!-- Role-based navigation -->
                        {% if user.is_superuser %}
                            <a href="/admin/" class="button">âš™ï¸ Admin</a>
                        {% elif user.profile and user.profile.role == 'manager' or user.profile and user.profile.role == 'superuser' %}
                            <a href="/manager/" class="button">ğŸ‘” Manager</a>
                        {% endif %}
                        
                        <!-- Staff Portal Access -->
                        {% if user.profile and user.profile.role and user.profile.role != 'viewer' %}
                            <a href="/api/staff/" class="button">ğŸ“‹ My Tasks</a>
                        {% endif %}
                        
                        <!-- Chat Access -->
                        <a href="/api/chat/" class="button">ğŸ’¬ Chat</a>
                        
                        <!-- Calendar Access -->
                        <a href="/api/portal/calendar/" class="button">ğŸ“… Calendar</a>
                        
                        <!-- Time display -->
                        <div class="portal-current-time">
                            {% current_time_dual user %}
                        </div>
                        
                        <!-- Theme toggle -->
                        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" title="Toggle light/dark mode">
                            <svg class="theme-toggle-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                            <svg class="theme-toggle-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>
                        
                        <!-- User info and logout -->
                        <span class="portal-user-name">{{ user.get_full_name|default:user.username }}</span>
                        <a href="{% url 'unified_logout' %}" class="button portal-logout">Logout</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" data-action="portal-close-nav"></div>

    <main class="container">
        <div class="portal-container">
            {% block content %}{% endblock %}
        </div>
    </main>
    <script src="{% static 'js/theme-toggle.js' %}"></script>
    <script type="module" src="{% static 'js/pages/portal-base.js' %}"></script>
    
    <!-- Hidden Sarcastic Message - Portal Theme-Aware Edition -->
    <div id="cosmo-secret-message-portal" class="portal-secret-message hidden">
        <div class="portal-secret-message-title">
            ğŸŒŸ A Portal Wanderer's Secret ğŸŒŸ
        </div>
        <div class="portal-secret-message-body">Oh, have you no shame, dear friend of mine?
To strut about boldly, crossing the line?
With cheek so divine and nerve so grand,
You march unashamed through all the land.

What audacity fills your trembling soul,
To flaunt your misdeeds as your lofty goal?
No blush, no hint of modesty's flame,
Tell me truly, have you no shame?

You wear shameless acts like a badge of pride,
As if decency has left your side.
Oh, the gall, the nerve, the unabashed gameâ€”
Pray tell, dear friend, have you no shame?</div>
    <button class="portal-secret-message-close" type="button" data-action="portal-secret-close">âœ¨ Close This Portal Secret âœ¨</button>
    </div>

    <!-- Secret Message Overlay -->
    <div id="secret-message-overlay-portal" class="portal-secret-overlay hidden"></div>
    
    <!-- Footer with Copyright -->
    <footer class="portal-footer">
        <p class="portal-footer-primary">&copy; 2025 Nguyen Phuong Duy Lam. All rights reserved. | <a class="portal-footer-link" href="https://lambertnguyen.cloud/company/products" target="_blank">Visit Our Products</a></p>
        <p class="portal-footer-secondary">Built with â¤ï¸ for learning.</p>
    </footer>
</body>
</html>


