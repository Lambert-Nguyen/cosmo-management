{% extends "portal/base.html" %}
{% load static %}
{% load timezone_tags %}

{% block title %}Photo Management Â· AriStay Portal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/portal-photo-management.css' %}">
{% endblock %}

{% block head %}
<script type="module" src="{% static 'js/pages/portal-photo-management.js' %}"></script>
{% endblock %}

{% block content %}
<div class="photo-management-container">
  <div id="photoManagementConfig" class="hidden" data-can-approve="{{ can_approve_photos|yesno:'true,false' }}"></div>
    <!-- Header Section -->
    <div class="card">
        <div class="section-title">
            <span class="title-icon">ğŸ–¼ï¸</span>
            Photo Management
        </div>
    <p class="portal-photo-management-description">
            Review and approve photos across all tasks. Manage photo status and ensure quality standards.
        </p>
        <div class="header-actions">
      <a href="/api/staff/photos/upload/" class="button portal-photo-management-upload-btn">
                <span class="btn-icon">ğŸ“¤</span>
                Upload Photos
            </a>
            <a href="/api/portal/" class="button secondary">
                <span class="btn-icon">ğŸ </span>
                Portal Home
            </a>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-number" id="totalPhotos">-</div>
            <div class="stat-label">Total Photos</div>
        </div>
        <div class="stat-card pending">
            <div class="stat-icon">â³</div>
            <div class="stat-number" id="pendingPhotos">-</div>
            <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card approved">
            <div class="stat-icon">âœ…</div>
            <div class="stat-number" id="approvedPhotos">-</div>
            <div class="stat-label">Approved</div>
        </div>
        <div class="stat-card rejected">
            <div class="stat-icon">âŒ</div>
            <div class="stat-number" id="rejectedPhotos">-</div>
            <div class="stat-label">Rejected</div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="card">
        <div class="section-title">
            <span class="title-icon">ğŸ”</span>
            Filters & Search
        </div>
        <div class="filters-content">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="taskFilter" class="filter-label">Task</label>
                    <select id="taskFilter" class="filter-select">
                        <option value="">All tasks</option>
                        {% for t in tasks %}
                            <option value="{{ t.id }}" {% if selected_task and selected_task.id == t.id %}selected{% endif %}>
                                #{{ t.id }} Â· {{ t.property_ref.name }} Â· {{ t.title|default:t.get_task_type_display }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label for="statusFilter" class="filter-label">Status</label>
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="pending">â³ Pending</option>
                        <option value="approved">âœ… Approved</option>
                        <option value="rejected">âŒ Rejected</option>
                        <option value="archived">ğŸ“ Archived</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="typeFilter" class="filter-label">Type</label>
                    <select id="typeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="before">ğŸ“· Before</option>
                        <option value="after">ğŸ“¸ After</option>
                        <option value="checklist">ğŸ“‹ Checklist</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button id="refreshBtn" class="button">
                        <span class="btn-icon">ğŸ”„</span>
                        Refresh
                    </button>
                    <button id="clearFiltersBtn" class="button secondary">
                        <span class="btn-icon">ğŸ—‘ï¸</span>
                        Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photos Grid -->
    <div class="card">
        <div class="section-title">
            <span class="title-icon">ğŸ“¸</span>
            Photos
            <span class="photo-count" id="photoCount">(0)</span>
        </div>
        <div class="photos-grid" id="photosGrid">
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <p>Loading photos...</p>
            </div>
        </div>
    </div>
</div>

<!-- Photo Card Template -->
<template id="photoCardTpl">
    <div class="photo-card" data-photo-id="">
        <div class="photo-thumbnail">
            <img data-el="img" src="" alt="" class="photo-image">
            <div class="photo-overlay">
                <button class="photo-action-btn view-btn" title="View Full Size">
                    <span class="btn-icon">ğŸ‘ï¸</span>
                </button>
                {% if can_approve_photos %}
                <div class="approval-actions" data-el="actions">
                    <button data-action="approve" class="photo-action-btn approve-btn" title="Approve">
                        <span class="btn-icon">âœ…</span>
                    </button>
                    <button data-action="reject" class="photo-action-btn reject-btn" title="Reject">
                        <span class="btn-icon">âŒ</span>
                    </button>
                    <button data-action="archive" class="photo-action-btn archive-btn" title="Archive">
                        <span class="btn-icon">ğŸ“</span>
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="photo-info">
            <div class="photo-meta">
                <span data-el="type" class="photo-type-badge"></span>
                <span data-el="status" class="photo-status-badge"></span>
            </div>
            <div class="photo-details" data-el="meta"></div>
            <div class="photo-actions" data-el="actions">
                {% if can_approve_photos %}
                <button data-action="approve" class="button portal-photo-management-action-btn approve">âœ… Approve</button>
                <button data-action="reject" class="button portal-photo-management-action-btn reject">âŒ Reject</button>
                <button data-action="archive" class="button portal-photo-management-action-btn archive">ğŸ“ Archive</button>
                {% endif %}
            </div>
        </div>
    </div>
</template>

<!-- Photo Modal -->
<div id="photoModal" class="photo-modal hidden">
    <div class="modal-backdrop" data-action="portal-photo-close-modal"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalPhotoTitle">Photo Viewer</h3>
            <button class="modal-close" type="button" data-action="portal-photo-close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <img id="modalPhoto" src="" alt="Photo" class="modal-photo">
        </div>
        <div class="modal-footer">
            <div class="modal-actions">
                <button class="button secondary" type="button" data-action="portal-photo-close-modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
